#include "FrameTimer.h"


using namespace std::chrono;

FrameTimer::FrameTimer()
	:
	last(steady_clock::now())
{
}

float FrameTimer::Mark()
{
	const steady_clock::time_point old = last;
	last = steady_clock::now();
	const duration<float> dur = last - old;
	return dur.count();
}

// Font implementation (appended here to ensure it's in the build)
#include "SpriteCodex.h"

void SpriteCodex::DrawChar(char c, int x, int y, Color color, Graphics& gfx)
{
	// Convert to uppercase
	if (c >= 'a' && c <= 'z')
	{
		c = c - 32;
	}
	
	// 5x7 font bitmap data
	static const unsigned char font[][7] = {
		{0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00}, // Space (32)
		{0x04, 0x04, 0x04, 0x04, 0x00, 0x04, 0x00}, // ! (33)
		{0x0A, 0x0A, 0x00, 0x00, 0x00, 0x00, 0x00}, // " (34)
		{0x0A, 0x1F, 0x0A, 0x1F, 0x0A, 0x00, 0x00}, // # (35)
		{0x04, 0x0F, 0x14, 0x0E, 0x05, 0x1E, 0x04}, // $ (36)
		{0x18, 0x19, 0x02, 0x04, 0x08, 0x13, 0x03}, // % (37)
		{0x0C, 0x12, 0x14, 0x08, 0x15, 0x12, 0x0D}, // & (38)
		{0x04, 0x04, 0x00, 0x00, 0x00, 0x00, 0x00}, // ' (39)
		{0x02, 0x04, 0x08, 0x08, 0x08, 0x04, 0x02}, // ( (40)
		{0x08, 0x04, 0x02, 0x02, 0x02, 0x04, 0x08}, // ) (41)
		{0x00, 0x0A, 0x04, 0x1F, 0x04, 0x0A, 0x00}, // * (42)
		{0x00, 0x04, 0x04, 0x1F, 0x04, 0x04, 0x00}, // + (43)
		{0x00, 0x00, 0x00, 0x00, 0x04, 0x04, 0x08}, // , (44)
		{0x00, 0x00, 0x00, 0x1F, 0x00, 0x00, 0x00}, // - (45)
		{0x00, 0x00, 0x00, 0x00, 0x00, 0x04, 0x00}, // . (46)
		{0x00, 0x01, 0x02, 0x04, 0x08, 0x10, 0x00}, // / (47)
		{0x0E, 0x11, 0x13, 0x15, 0x19, 0x11, 0x0E}, // 0 (48)
		{0x04, 0x0C, 0x04, 0x04, 0x04, 0x04, 0x0E}, // 1 (49)
		{0x0E, 0x11, 0x01, 0x02, 0x04, 0x08, 0x1F}, // 2 (50)
		{0x0E, 0x11, 0x01, 0x06, 0x01, 0x11, 0x0E}, // 3 (51)
		{0x02, 0x06, 0x0A, 0x12, 0x1F, 0x02, 0x02}, // 4 (52)
		{0x1F, 0x10, 0x1E, 0x01, 0x01, 0x11, 0x0E}, // 5 (53)
		{0x06, 0x08, 0x10, 0x1E, 0x11, 0x11, 0x0E}, // 6 (54)
		{0x1F, 0x01, 0x02, 0x04, 0x08, 0x08, 0x08}, // 7 (55)
		{0x0E, 0x11, 0x11, 0x0E, 0x11, 0x11, 0x0E}, // 8 (56)
		{0x0E, 0x11, 0x11, 0x0F, 0x01, 0x02, 0x0C}, // 9 (57)
		{0x00, 0x04, 0x00, 0x00, 0x00, 0x04, 0x00}, // : (58)
		{0x00, 0x04, 0x00, 0x00, 0x04, 0x04, 0x08}, // ; (59)
		{0x02, 0x04, 0x08, 0x10, 0x08, 0x04, 0x02}, // < (60)
		{0x00, 0x00, 0x1F, 0x00, 0x1F, 0x00, 0x00}, // = (61)
		{0x08, 0x04, 0x02, 0x01, 0x02, 0x04, 0x08}, // > (62)
		{0x0E, 0x11, 0x01, 0x02, 0x04, 0x00, 0x04}, // ? (63)
		{0x0E, 0x11, 0x17, 0x15, 0x17, 0x10, 0x0E}, // @ (64)
		{0x0E, 0x11, 0x11, 0x1F, 0x11, 0x11, 0x11}, // A (65)
		{0x1E, 0x11, 0x11, 0x1E, 0x11, 0x11, 0x1E}, // B (66)
		{0x0E, 0x11, 0x10, 0x10, 0x10, 0x11, 0x0E}, // C (67)
		{0x1E, 0x11, 0x11, 0x11, 0x11, 0x11, 0x1E}, // D (68)
		{0x1F, 0x10, 0x10, 0x1E, 0x10, 0x10, 0x1F}, // E (69)
		{0x1F, 0x10, 0x10, 0x1E, 0x10, 0x10, 0x10}, // F (70)
		{0x0E, 0x11, 0x10, 0x17, 0x11, 0x11, 0x0E}, // G (71)
		{0x11, 0x11, 0x11, 0x1F, 0x11, 0x11, 0x11}, // H (72)
		{0x0E, 0x04, 0x04, 0x04, 0x04, 0x04, 0x0E}, // I (73)
		{0x07, 0x02, 0x02, 0x02, 0x02, 0x12, 0x0C}, // J (74)
		{0x11, 0x12, 0x14, 0x18, 0x14, 0x12, 0x11}, // K (75)
		{0x10, 0x10, 0x10, 0x10, 0x10, 0x10, 0x1F}, // L (76)
		{0x11, 0x1B, 0x15, 0x11, 0x11, 0x11, 0x11}, // M (77)
		{0x11, 0x19, 0x15, 0x13, 0x11, 0x11, 0x11}, // N (78)
		{0x0E, 0x11, 0x11, 0x11, 0x11, 0x11, 0x0E}, // O (79)
		{0x1E, 0x11, 0x11, 0x1E, 0x10, 0x10, 0x10}, // P (80)
		{0x0E, 0x11, 0x11, 0x11, 0x15, 0x12, 0x0D}, // Q (81)
		{0x1E, 0x11, 0x11, 0x1E, 0x14, 0x12, 0x11}, // R (82)
		{0x0F, 0x10, 0x10, 0x0E, 0x01, 0x01, 0x1E}, // S (83)
		{0x1F, 0x04, 0x04, 0x04, 0x04, 0x04, 0x04}, // T (84)
		{0x11, 0x11, 0x11, 0x11, 0x11, 0x11, 0x0E}, // U (85)
		{0x11, 0x11, 0x11, 0x11, 0x11, 0x0A, 0x04}, // V (86)
		{0x11, 0x11, 0x11, 0x15, 0x15, 0x15, 0x0A}, // W (87)
		{0x11, 0x11, 0x0A, 0x04, 0x0A, 0x11, 0x11}, // X (88)
		{0x11, 0x11, 0x0A, 0x04, 0x04, 0x04, 0x04}, // Y (89)
		{0x1F, 0x01, 0x02, 0x04, 0x08, 0x10, 0x1F}  // Z (90)
	};
	
	int index = c - 32;
	if (index < 0 || index >= 59)
	{
		return;
	}
	
	for (int row = 0; row < 7; row++)
	{
		unsigned char rowData = font[index][row];
		for (int col = 0; col < 5; col++)
		{
			if (rowData & (1 << (4 - col)))
			{
				gfx.PutPixel(x + col, y + row, color);
			}
		}
	}
}

void SpriteCodex::DrawString(const std::string& text, int x, int y, Color color, Graphics& gfx)
{
	int cursorX = x;
	for (char c : text)
	{
		DrawChar(c, cursorX, y, color, gfx);
		cursorX += 6;
	}
}